Shared.Finishable = Ember.Mixin.create

  track: Ember.required()
  _finishLine: null
    
  drawTrack: (path) ->
    @_super path
    @_drawFinishLine()
  
  _drawFinishLine: ->
    return unless @_paper? and @track.get 'isLoaded'

    pointA = @track.getPointAtLength 20
    pointB = @track.getPointAtLength 23
    
    x = pointB.x - pointA.x
    y = pointB.y - pointA.y
    
    vector = Shared.Vector.create x: x, y: y
    
    @_finishLine = @_paper.image "<%= asset_path('views/play/finish-line.jpg') %>", pointA.x * @scaleFactor, pointA.y * @scaleFactor, 70, 20
    @_finishLine.transform "t#{-35},#{-10}r#{vector.clockwiseAngle()}s#{@scaleFactor},#{@scaleFactor}"
