
#= require helpers/event_normalize
#= require slotcars/shared/views/track_view
#= require helpers/math/vector

Vector = helpers.math.Vector

Play.PlayTrackView = Shared.TrackView.extend
  
  _finishLine: null
    
  drawTrack: (path) ->
    @_super path
    @_drawFinishLine()
  
  _drawFinishLine: ->
    return unless @_paper?
  
    pointA = @track.getPointAtLength 20
    pointB = @track.getPointAtLength 23
    
    x = pointB.x - pointA.x
    y = pointB.y - pointA.y
    
    vector = Vector.create x: x, y: y
    
    @_finishLine.remove() if @_finishLine
    @_finishLine = @_paper.image "<%= asset_path('views/play/finish-line.jpg') %>", pointA.x, pointA.y, 70, 20
    @_finishLine.transform "t#{-35},#{-10}r#{vector.clockwiseAngle()}"